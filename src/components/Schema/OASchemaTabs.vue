<script setup>
import { computed } from 'vue'
import { useTheme } from '../../composables/useTheme'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs'
import OASchemaUI from '../Schema/OASchemaUI.vue'
import OAMarkdown from '../Common/OAMarkdown.vue'

const props = defineProps({
  schema: {
    type: Object,
    required: true,
  },
  examples: {
    type: null,
    required: false,
  },
  isDark: {
    type: Boolean,
    default: false,
  },
})

const themeConfig = useTheme()

const defaultValue = computed(() => {
  const examplesKeys = Object.keys(props.examples ?? {})

  if (themeConfig.schemaConfig.defaultView.value === 'schema') {
    return 'schema'
  }

  if (themeConfig.schemaConfig.defaultView.value === 'contentType') {
    return examplesKeys?.length ? `examples.${examplesKeys[0]}` : 'schema'
  }

  if (themeConfig.schemaConfig.defaultView.value === 'autogenerated') {
    const autogeneratedExample = examplesKeys.find(key => props.examples[key]?.isAutogenerated)
    return autogeneratedExample ? `examples.${autogeneratedExample}` : 'schema'
  }

  return themeConfig.schemaConfig.defaultView.value
})
</script>

<template>
  <Tabs
    :default-value="defaultValue"
  >
    <TabsList class="relative flex flex-row justify-start">
      <TabsTrigger
        value="schema"
        variant="schemaTabs"
        class="h-full"
      >
        {{ $t('Schema') }}
      </TabsTrigger>
      <TabsTrigger
        v-for="example in Object.keys(props.examples ?? {})"
        :key="example"
        :value="`examples.${example}`"
        variant="schemaTabs"
        class="h-full"
      >
        {{ example }}
      </TabsTrigger>
    </TabsList>
    <TabsContent value="schema">
      <div class="flex flex-col gap-2">
        <OASchemaUI
          :property="props.schema"
          :schema="props.schema"
          :deep="themeConfig.getSchemaViewerDeep()"
        />
      </div>
    </TabsContent>
    <TabsContent
      v-for="example in Object.keys(props.examples ?? {})"
      :key="example"
      :value="`examples.${example}`"
    >
      <div class="flex flex-col gap-2">
        <OAMarkdown
          v-if="props.examples[example]?.description"
          :content="props.examples[example]?.description"
        />

        <OACodeBlock
          v-if="props.examples[example]?.value"
          :code="props.examples[example]?.value"
          :lang="props.examples[example]?.lang ?? 'json'"
          :label="(props.examples[example]?.lang ?? 'json').toUpperCase()"
          :is-dark="props.isDark"
          class="!my-0"
        />
      </div>
    </TabsContent>
  </Tabs>
</template>
